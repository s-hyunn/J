package c01;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;
import java.util.Scanner;

public class Membertest {

	public static void main(String[] args) throws ClassNotFoundException, SQLException {
		
		List<Member> list = new ArrayList<>();
		Scanner sc = new Scanner(System.in);
		Class.forName("oracle.jdbc.OracleDriver");

		String url = "jdbc:oracle:thin:@localhost:1521:xe"; //1521:xe  /XEPDB1
		String id = "green";
		String pw = "1234";

		// ì ‘ì†ë‹´ë‹¹ -connection
		Connection conn = DriverManager.getConnection(url, id, pw);

		// ì¿¼ë¦¬ì‹¤í–‰- Statement import sql ê²ƒ ì‚¬ìš© ì¤‘ìš”!!!
		Statement stmt = conn.createStatement();
		conn.setAutoCommit(true); // ì´ê±° ì¶”ê°€í•´ë³´ì!
		System.out.println("DB ì—°ê²° ì„±ê³µ!");

		if (conn != null) {
		    System.out.println("ì»¤ë„¥ì…˜ ìœ íš¨");
		}

		Member m1 = new Member();

//		System.out.println("íšŒì›ê°€ì…ì„ ì§„í–‰í•©ë‹ˆë‹¤");
//
//		System.out.println("ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
//		m1.setId(sc.nextLine());
//
//		System.out.println("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
//		m1.setPw(sc.nextLine());
//
//		System.out.println("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
//		m1.setName(sc.nextLine());
//
//		System.out.println("ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
//		m1.setPhone(sc.nextLine());
//
//		System.out.println("ë“±ê¸‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
//		m1.setGrade(sc.nextLine());
//
//		String query = "INSERT INTO tbl_member VALUES (" 
//				+ "'" + m1.getId() + "', " 
//				+ "'" + m1.getPw() + "', "
//				+ "'" + m1.getName() + "', " 
//				+ "'" + m1.getPhone() + "', " 
//				+ "'" + m1.getGrade() + "') ";
//		
//		
//
//		int result = stmt.executeUpdate(query);
//
//		System.out.println("result: " + result);
//
//		System.out.println("íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
//		
//		
		// ê²Œì‹œê¸€ ì‘ì„±

		Board b1 = new Board();
		Statement stmt1 = conn.createStatement();

		System.out.println("ğŸ“Œ ê²Œì‹œê¸€ ì‘ì„±ì„ ì§„í–‰í•©ë‹ˆë‹¤");

		System.out.print("ê¸€ ë²ˆí˜¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”: ");
		b1.setBno(sc.nextLine());

		System.out.print("ê¸€ ì œëª©ì„ ì‘ì„±í•´ì£¼ì„¸ìš”: ");
		b1.setTitle(sc.nextLine());

		System.out.print("ê²Œì‹œê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”: ");
		b1.setContent(sc.nextLine());

		System.out.print("ì‘ì„±ì ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”: ");
		b1.setWriter(sc.nextLine());

		String query1 = "INSERT INTO tbl_board VALUES (" 
			+ "'" + b1.getBno() + "', " 
			+ "'" + b1.getTitle() + "', " 
			+ "'" + b1.getContent() + "', " 
			+ "'" + b1.getWriter() + "', SYSDATE)";

		int result1 = stmt1.executeUpdate(query1);

		System.out.println("âœ… ê²Œì‹œê¸€ ì‘ì„± ì™„ë£Œ!");
		System.out.println("ë“±ë¡ ê²°ê³¼: " + result1 + "ê±´ ì…ë ¥ë¨");

		// ê²Œì‹œê¸€ ì¡°íšŒ - List ì‚¬ìš©
		List<Board> boardList = new ArrayList<>();
		Statement stmt2 = conn.createStatement();
		String query2 = "SELECT * FROM tbl_board";

		ResultSet rs = stmt2.executeQuery(query2);

		while (rs.next()) {
			Board b = new Board();
			b.setBno(rs.getString("bno"));
			b.setTitle(rs.getString("title"));
			b.setContent(rs.getString("content"));
			b.setWriter(rs.getString("writer"));
			b.setRegdate(rs.getString("regdate")); // ì»¬ëŸ¼ëª… ìˆ˜ì • í•„ìš”!

			boardList.add(b);
		}

		// ì¶œë ¥
		System.out.println("\nğŸ“‹ ê²Œì‹œê¸€ ëª©ë¡ (List ì‚¬ìš©)");
		System.out.println("ë²ˆí˜¸\tì œëª©\tì‘ì„±ì\tì‘ì„±ì¼");

		for (Board b : boardList) {
			System.out.println(b);
		}
		// âœ… ì„ íƒ ì¡°íšŒ ê¸°ëŠ¥ ì¶”ê°€ (ê²Œì‹œê¸€ ë²ˆí˜¸ ì…ë ¥ë°›ì•„ì„œ ì¡°íšŒ)
		System.out.print("\nğŸ” ì¡°íšŒí•  ê²Œì‹œê¸€ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”: ");
		String searchBno = sc.nextLine();

		String query3 = "SELECT * FROM tbl_board WHERE bno = '" + searchBno + "'";
		Statement stmt3 = conn.createStatement();
		ResultSet rs2 = stmt3.executeQuery(query3);

		if (rs2.next()) {
			System.out.println("\nğŸ“Œ ê²Œì‹œê¸€ ìƒì„¸ ì •ë³´");
			System.out.println("ë²ˆí˜¸: " + rs2.getString("bno"));
			System.out.println("ì œëª©: " + rs2.getString("title"));
			System.out.println("ë‚´ìš©: " + rs2.getString("content"));
			System.out.println("ì‘ì„±ì: " + rs2.getString("writer"));
			System.out.println("ì‘ì„±ì¼: " + rs2.getString("regdate"));
		} else {
			System.out.println("â— í•´ë‹¹ ë²ˆí˜¸ì˜ ê²Œì‹œê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
		}
		// ìì›ì •ë¦¬
		rs.close();
		stmt1.close();
		stmt2.close();
		stmt.close();
		conn.close();
	}
}
